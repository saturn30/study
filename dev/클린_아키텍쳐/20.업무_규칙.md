# 20. 업무 규칙

업무 규칙 = 비즈니스 로직

애플리케이션을 업무 규칙과 플러그인으로 구분하려면 업무 규칙이 실제로 무엇인지를 잘 이해해야만 한다. 업무 규칙에는 여러 가지가 있다. 엄밀하게 말하면 업무 규칙은 사업적으로 수익을 얻거나 비용을 줄일 수 있는 규칙 또는 절차다. 컴퓨터상으로 구현했는지 와는 상관없이, 업무 규칙은 사업적으로 수익을 얻거나 비용을 줄일 수 있어야 한다. 심지어 사람이 수동으로 수행하더라도 마찬가지이다.

예를 들어 대출 N%의 이자를 부과한다는 사실은 은행이 돈을 버는 업무 규칙이다. 이를 컴퓨터 프로그램으로 자동으로 이자를 계산하든, 직원이 직접 계산하든 상관없다. 이러한 규칙을 핵심 업무 규칙이라 부른다. 이들 규칙은 사업 자체에 핵심적이며, 규칙을 자동화하는 시스템이 없더라도 업무 규칙은 그대로 존재한다. 핵심 업무 규칙은 보통 데이터를 요구한다. 이러한 데이터를 핵심 업무 데이터라 부른다.

핵심 규칙과 핵심 데이터는 본질적으로 결합되어 있기 때문에 객체로 만들 좋은 후보가 된다. 이러한 유형의 객체를 엔티티라고 한다.

## **엔티티**

- 엔티티는 컴퓨터 시스템 내부의 객체로서, 핵심 업무 데이터를 기반으로 동작하는 일련의 조그만 핵심 업무 규칙을 구체화한다.
  - 엔티티 객체는 핵심 업무 데이터를 직접 포함하거나 핵심 업무 데이터에 매우 쉽게 접근할 수 있다.
  - 엔티티의 인터페이스는 핵심 업무 데이터를 기반으로 동작하는 핵심 업무 규칙을 구현한 함수들로 구성된다.
- 이러한 종류의 클래스를 생성할 때, 업무에서 핵심적인 개념을 구현하는 소프트웨어는 한데 모으고, 구축 중인 자동화 시스템의 나머지 모든 고려 사항과 분리시킨다.
  - 이 클래스는 업무의 대표자로서 독립적으로 존재한다.
  - 데이터베이스, 사용자 인터페이스, 서드파티 프레임워크에 대한 고려 사항들로 인해 오염되어서는 절대 안 된다.
  - 어떤 시스템에서도 업무를 수행할 수 있으며, 시스템의 표현 형식이나 데이터 저장 방식, 그리고 해당 시스템에서 컴퓨터가 배치되는 방식과도 무관하다.
- 엔티티의 유일한 요구 조건은 핵심 업무 데이터와 핵심 업무 규칙을 하나로 묶어서 별도의 소프트웨어 모듈로 만들어야 한다는 것이다.

## **유스 케이스**

- 모든 업무 규칙이 엔티티처럼 순수한 것은 아니다.
  - 자동화된 시스템이 동작하는 방법을 정의하고 제약함으로써 수익을 얻거나 비용을 줄이는 업무 규칙도 존재한다.
  - 이러한 규칙은 자동화된 시스템의 요소로 존재해야만 의미가 있으므로 수동 환경에서는 사용될 수 없다.
- 유스 케이스는 자동화된 시스템이 사용되는 방법을 설명한다.
  - 사용자가 제공해야 하는 입력, 사용자에게 보여줄 출력, 그리고 해당 출력을 생성하기 위한 처리단계를 기술한다.
  - 엔티티 내의 핵심 업무 규칙과는 반대로, 유스 케이스는 애플리케이션에 특화된 업무 규칙을 설명한다.
- 유스 케이스는 엔티티 내부의 핵심 업무 규칙을 어떻게, 그리고 언제 호출할지를 명시하는 규칙을 담는다.
  - 엔티티가 어떻게 춤을 출지를 유스 케이스가 정의하는 것이다.
- 주목할 또 다른 사실은 인터페이스로 들어오는 데이터와 인터페이스에서 되돌려주는 데이터를 형식 없이 명시한다는 점만 빼면, 유스 케이스는 사용자 인터페이스를 기술하지 않는다는 점이다.
  - 유스 케이스만 봐서는 이 애플리케이션이 웹인지, 콘솔 기반인지, 순수한 서비스인지를 구분할 수 없다.
  - 유스 케이스는 시스템이 사용자에게 어떻게 보이는지를 설명하지 않는다.
  - 이보다는 애플리케이션에 특화된 규칙을 설명하며, 이를 통해 사용자와 엔티티 사이의 상호작용을 규정한다.
  - 시스템에서 데이터가 들어오고 나가는 방식은 유스 케이스와 무관하다.
- 엔티티는 자신을 제어하는 유스 케이스에 대해 아무것도 알지 못한다.
  - 이는 의존성 역전 원칙을 준수하는 의존성 방향에 대한 예시이다.
  - 엔티티와 같은 고수준 개념은 유스 케이스와 같은 저 수준 개념에 대해 아무것도 알지 못한다.
  - 반대로 저 수준인 유스 케이스는 고 수준인 엔티티에 대해 알고 있다.
  - 왜 엔티티가 고수준이며, 유스 케이스는 저 수준일까? 왜냐하면 유스 케이스는 단일 애플리케이션에 특화되어 있으며, 따라서 해당 시스템의 입력과 출력에 보다 가깝게 위치하기 때문이다.

## **요청 및 응답 모델**

- 유스 케이스는 입력 데이터를 받아서 출력 데이터를 생성한다.
  - 하지만 유스 케이스 객체는 사용자나 또 다른 컴포넌트와 주고받는 방식에 대해서는 알 수 없다.
  - 유스 케이스 클래스의 코드가 HTML이나 SQL에 대해 알게 되는 일을 원치 않는다.
- 유스 케이스는 단순한 요청 데이터 구조를 입력으로 받아들이고, 단순한 응답 데이터 구조를 출력으로 반환한다.
  - 이들 데이터 구조는 어떤 것에도 의존하지 않는다.
- 이처럼 의존성을 제거하는 일은 중요하다. 요청 및 응답 모델이 독립적이지 않다면, 그 모델에 의존하는 유스 케이스도 결국 해당 모델이 수반하는 의존성에 간접적으로 결합되어 버린다.

## **결론**

- 업무 규칙은 소프트웨어 시스템이 존재하는 이유다.
- 업무 규칙은 핵심적인 기능이다.
- 업무 규칙은 수익을 내고 비용을 줄이는 코드를 수반한다.
- 업무 규칙은 사용자 인터페이스나 데이터베이스와 같은 저 수준의 관심사로 인해 오염되어서는 안 되며, 원래 그대로의 모습으로 남아있어야 한다.
- 이상적으로는 업무 규칙을 표현하는 코드는 반드시 시스템의 심장부에 위치해야 하며, 덜 중요한 코드는 이 심장부에 플러그인 되어야 한다.
- 업무규칙은 시스템에서 가장 독립적이며 가장 많이 재사용할 수 있는 코드여야 한다.
